!function(){d3._extend=function(e,t){var n,o={};for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(o[n]=e[n]);for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(o[n]=t[n]);return o},d3._pxToNumber=function(e){return parseFloat(e.replace("px"))},d3._windowHeight=function(){return window.innerHeight||document.documentElement.clientHeight||600},d3._getPosition=function(e,t){var n=e.node().getBoundingClientRect();return cPos=t.node().getBoundingClientRect(),{top:n.top-cPos.top,left:n.left-cPos.left,width:n.width,bottom:n.bottom-cPos.top,height:n.height,right:n.right-cPos.left}},d3.netJsonGraph=function(e,t){if((t=d3._extend({el:"body",metadata:!0,defaultStyle:!0,animationAtStart:!0,scaleExtent:[.25,5],charge:-130,linkDistance:50,linkStrength:.2,friction:.9,chargeDistance:1/0,theta:.8,gravity:.1,circleRadius:8,labelDx:"0",labelDy:"-1.3em",nodeClassProperty:null,linkClassProperty:null,onInit:function(e,t){},onLoad:function(e,t){},onEnd:function(e,t){},linkDistanceFunc:function(e){var n=t.linkDistance;return e.source.linkCount>=4&&e.target.linkCount>=4?2*n:n},redraw:function(){c.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")},prepareData:function(e){for(var t={},n=e.nodes.slice(),o=e.links.slice(),r=e.nodes.length,a=e.links.length,l=0;l<r;l++)n[l].linkCount=0,t[n[l].id]=l;for(var i=0;i<a;i++){var s=t[o[i].source],c=t[o[i].target];if(!n[s])throw"source '"+o[i].source+"' not found";if(!n[c])throw"target '"+o[i].target+"' not found";o[i].source=t[o[i].source],o[i].target=t[o[i].target],n[s].linkCount++,n[c].linkCount++}return console.log(t),{nodes:n,links:o}},onClickNode:function(e){var t=d3.select(".njg-overlay"),n=d3.select(".njg-overlay > .njg-inner"),o="<p><b>id</b>: "+e.id+"</p>";if(e.label&&(o+="<p><b>label</b>: "+e.label+"</p>"),e.properties)for(var r in e.properties)e.properties.hasOwnProperty(r)&&(o+="<p><b>"+r.replace(/_/g," ")+"</b>: "+e.properties[r]+"</p>");e.linkCount&&(o+="<p><b>links</b>: "+e.linkCount+"</p>"),e.local_addresses&&(o+="<p><b>local addresses</b>:<br>"+e.local_addresses.join("<br>")+"</p>"),n.html(o),t.classed("njg-hidden",!1),t.style("display","block"),m(),d3.select(this).classed("njg-open",!0)},onClickLink:function(e){var t=d3.select(".njg-overlay"),n=d3.select(".njg-overlay > .njg-inner"),o="<p><b>source</b>: "+(e.source.label||e.source.id)+"</p>";if(o+="<p><b>target</b>: "+(e.target.label||e.target.id)+"</p>",o+="<p><b>cost</b>: "+e.cost+"</p>",e.properties)for(var r in e.properties)e.properties.hasOwnProperty(r)&&(o+="<p><b>"+r.replace(/_/g," ")+"</b>: "+e.properties[r]+"</p>");n.html(o),t.classed("njg-hidden",!1),t.style("display","block"),m(),d3.select(this).classed("njg-open",!0)}},t)).onInit(e,t),t.animationAtStart||(t.linkStrength=2,t.friction=.3,t.gravity=0),"body"==t.el){var n=d3.select(t.el),o=n.node().getBoundingClientRect();d3._pxToNumber(d3.select("body").style("height"))<60&&n.style("height",d3._windowHeight()-o.top-o.bottom+"px")}var r=d3.select(t.el).style("position","relative"),a=d3._pxToNumber(r.style("width")),l=d3._pxToNumber(r.style("height")),i=d3.layout.force().charge(t.charge).linkStrength(t.linkStrength).linkDistance(t.linkDistanceFunc).friction(t.friction).chargeDistance(t.chargeDistance).theta(t.theta).gravity(t.gravity).size([a,l]),s=d3.behavior.zoom().scaleExtent(t.scaleExtent),c=r.classed("svg-container",!0).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+window.outerWidth+" "+window.outerHeight).classed("svg-content-responsive",!0).call(s.on("zoom",t.redraw)).append("g").style("position","absolute"),d=d3.select(t.el+" svg"),p=i.drag(),u=d3.select(t.el).append("div").attr("class","njg-overlay"),g=u.append("a").attr("class","njg-close"),v=u.append("div").attr("class","njg-inner"),f=d3.select(t.el).append("div").attr("class","njg-metadata"),y=f.append("div").attr("class","njg-inner"),h=f.append("a").attr("class","njg-close"),b=[],k=[],m=function(){d3.selectAll("svg .njg-open").classed("njg-open",!1)};processJson=function(n){init=function(e,t){d3.netJsonGraph(e,t)},destroy=function(){i.stop(),d3.select("#selectGroup").remove(),d3.select(".njg-overlay").remove(),d3.select(".njg-metadata").remove(),u.remove(),v.remove(),f.remove(),d.remove(),node.remove(),l.remove(),a=[],r=[]},reInit=function(){destroy(),init(e,t)};var o=t.prepareData(n),r=o.links,a=o.nodes;p.on("dragstart",function(e){d3.event.sourceEvent.stopPropagation(),s.on("zoom",null)}).on("dragend",function(e){s.on("zoom",t.redraw)}).on("drag",function(e){d3.select(this).attr("x",e.x=d3.event.x).attr("y",e.y=d3.event.y)}),i.nodes(a).links(r).start();var l=c.selectAll(".link").data(r).enter().append("line").attr("class",function(e){var n=null;return value=e.properties&&e.properties[t.linkClassProperty],t.linkClassProperty&&value?("string"==typeof value?n=value:"number"==typeof value?n=t.linkClassProperty+value:!0===value&&(n=t.linkClassProperty),"njg-link "+n):"njg-link"}).on("click",t.onClickLink),b=c.selectAll(".node").data(a).enter().append("g");node=b.append("circle").attr("class",function(e){var n=null;return value=e.properties&&e.properties[t.nodeClassProperty],t.nodeClassProperty&&value?("string"==typeof value?n=value:"number"==typeof value?n=t.nodeClassProperty+value:!0===value&&(n=t.nodeClassProperty),"njg-node "+n):"njg-node"}).attr("r",t.circleRadius).on("click",function(){d3.event.defaultPrevented||t.onClickNode()}).call(p);var k=b.append("text").text(function(e){return e.label||e.id}).attr("dx",t.labelDx).attr("dy",t.labelDy).attr("class","njg-tooltip");if(g.on("click",function(){m(),u.classed("njg-hidden",!0)}),h.on("click",function(){"NetworkCollection"===n.type?reInit():(m(),f.classed("njg-hidden",!0))}),t.defaultStyle){var j=d3.scale.category20c();node.style({fill:function(e){return j(e.linkCount)},cursor:"pointer"})}t.metadata&&f.attr("class","njg-metadata").style("display","block");var x=["protocol","version","revision","metric","router_id","topology_id"],C="";n.label&&(C+="<h3>"+n.label+"</h3>");for(var w in x){var P=x[w];n[P]&&(C+="<p><b>"+P+"</b>: <span>"+n[P]+"</span></p>")}return C+="<p><b>nodes</b>: <span>"+n.nodes.length+"</span></p>",C+="<p><b>links</b>: <span>"+n.links.length+"</span></p>",y.html(C),f.classed("njg-hidden",!1),t.onLoad(e,t),i.on("tick",function(){l.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),node.attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}),k.attr("transform",function(e){return"translate("+e.x+","+e.y+")"})}).on("end",function(){i.stop(),t.onEnd(e,t)}),i},"object"==typeof e?processJson(e):d3.json(e,function(e,t){if(e)throw e;if("NetworkCollection"===t.type){var o=n.append("div").attr("id","njg-select-group"),r=o.append("select").attr("id","select");b=t,r.append("option").attr({value:"",selected:"selected",name:"default",disabled:"disabled"}).html("Choose the network to display"),t.collection.forEach(function(e){r.append("option").attr("value",e.type).html(e.type),k[e.type]=e}),r.on("change",function(){o.attr("class","njg-hidden"),processJson(k[this.options[this.selectedIndex].value])})}else processJson(t)})}}();